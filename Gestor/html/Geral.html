<!DOCTYPE html>
<html lang="pt">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Geral - EyesEverywhere</title>
  <link rel="stylesheet" href="/Back-Office/Gestor/css/Geral.css" />
  <link rel="icon" href="/Back-Office/Gestor/Imagens/logo.png" />
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div id="app">
    <div class="sidebar">
      <div class="logo">
        <img src="/Back-Office/Gestor/Imagens/logo.png" alt="EyesEverywhere" />
      </div>
      <nav>
        <ul>
          <li><a data-page="Ocorrencias.html" href="Ocorrencias.html">📋 Ocorrências</a></li>
          <li><a data-page="NovasOcorrencias.html" href="NovasOcorrencias.html">➕ Novas Ocorrências</a></li>
          <li><a data-page="Peritos.html" href="Peritos.html">👥 Peritos</a></li>
          <li><a data-page="Registar_Peritos.html" href="Registar_Peritos.html">📝 Registar Peritos</a></li>
          <li><a class="active" data-page="Geral.html" href="Geral.html">🔍 Estatísticas</a></li>
        </ul>
      </nav>
      <div class="add-auditoria">
        <button>+ Adicionar Plano de Auditoria</button>
      </div>
      <div class="user-info">
        <p>{{ userName }}</p>
        <p>{{ userEmail }}</p>
      </div>
    </div>

    <div class="content">
      <header>
        <h1>Estatísticas</h1>
      </header>

      <main>
        <section class="cards">
          <div class="card">
            <h3>Utilizadores Ativos</h3>
            <p>{{ usuariosAtivos }}/5000</p>
          </div>
          <div class="card">
            <h3>Nº Ocorrências Resolvidas</h3>
            <p>{{ numeroOcorrencias }}</p>
          </div>
          <div class="card">
            <h3>Custo médio por auditoria</h3>
            <p>150€</p>
          </div>
          <div class="card">
            <h3>Tempo médio de resposta</h3>
            <p>{{ tempoMedioResposta }}</p>
          </div>
        </section>

        <section class="charts">
          <div class="chart-box">
            <h3>Especialidades dos Peritos</h3>
            <canvas id="especialidadesChart"></canvas>
          </div>
          <div class="chart-box">
            <h3>Ocorrências Resolvidas por Mês</h3>
            <canvas id="ocorrenciasMensaisChart"></canvas>
          </div>
        </section>

        <section class="bottom-section">
          <div class="chart-box wide">
            <h3>Dinheiro</h3>
            <canvas id="dinheiroChart"></canvas>
          </div>
        </section>
      </main>
    </div>
  </div>

  <script>
    new Vue({
      el: '#app',
      data: {
        usuariosAtivos: 27,
        numeroOcorrencias: 1435,
        tempoMedioResposta: '2d 3h',
        peritos: JSON.parse(localStorage.getItem("peritos")) || [],
        userName: localStorage.getItem("userName") || "Usuário não logado",
        userEmail: localStorage.getItem("userEmail") || "Sem e-mail"
      },
      computed: {
        especialidades() {
          const contador = {};
          this.peritos.forEach(perito => {
            if (contador[perito.especialidade]) {
              contador[perito.especialidade]++;
            } else {
              contador[perito.especialidade] = 1;
            }
          });
          return contador;
        }
      },
      mounted() {
        this.renderChart();
        this.renderOcorrenciasMensaisChart();
      },
      methods: {
        renderChart() {
          const especialidadesData = this.especialidades;
          const labels = Object.keys(especialidadesData);
          const data = Object.values(especialidadesData);

          const ctx = document.getElementById('especialidadesChart').getContext('2d');
          new Chart(ctx, {
            type: 'pie',
            data: {
              labels: labels,
              datasets: [{
                data: data,
                backgroundColor: ['#00C49F', '#FFBB28', '#0088FE', '#FF8042']
              }]
            }
          });
        },

        renderOcorrenciasMensaisChart() {
          const ctx = document.getElementById('ocorrenciasMensaisChart').getContext('2d');
          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'],
              datasets: [{
                label: 'Ocorrências Resolvidas',
                data: [12, 19, 3, 5, 2, 3, 10, 15, 13, 18, 22, 30],
                backgroundColor: '#0088FE'
              }]
            }
          });
        },

        addPerito(perito) {
          this.peritos.push(perito);
          localStorage.setItem("peritos", JSON.stringify(this.peritos));
          this.renderChart(); // Re-renderize o gráfico após adicionar um novo perito
        }
      }
    });
  </script>
</body>
</html>
