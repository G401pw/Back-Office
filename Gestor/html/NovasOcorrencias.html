<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Novas OcorrÃªncias - EyesEverywhere</title>
  <link rel="stylesheet" href="/Back-Office/Gestor/css/NovasOcorrencias.css" />
  <link rel="icon" href="/Back-Office/Gestor/Imagens/logo.png" type="image/x-icon" />
</head>
<body>
  <div class="sidebar">
    <div class="logo">
      <img src="/Back-Office/Gestor/Imagens/logo.png" alt="EyesEverywhere" />
    </div>
    <nav>
      <ul>
        <li><a data-page="Ocorrencias.html" href="Ocorrencias.html">ğŸ“‹ OcorrÃªncias</a></li>
        <li><a class="active" data-page="NovasOcorrencias.html" href="NovasOcorrencias.html">â• Novas OcorrÃªncias</a></li>
        <li><a data-page="Peritos.html" href="Peritos.html">ğŸ‘¥ Peritos</a></li>
        <li><a data-page="Registar_Peritos.html" href="Registar_Peritos.html">ğŸ“ Registar Peritos</a></li>
        <li><a data-page="Geral.html" href="Geral.html">ğŸ” EstatÃ­sticas</a></li>
      </ul>
    </nav>
    <div class="add-auditoria">
      <a href="/Back-Office/Gestor/html/PlanoAuditoria.html">
        <button>+ Adicionar Plano de Auditoria</button>
      </a>
    </div>
    <div class="user-info">
      <p id="user-name">Utilizador nÃ£o logado</p>
      <p id="user-email">Sem e-mail</p>
    </div>
  </div>

  <div class="content">
    <header>
      <h1>OcorrÃªncias</h1>
    </header>

    <main>
      <section class="ocorrencias" id="ocorrencias-lista">
        <!-- Aqui as ocorrÃªncias vÃ£o ser carregadas dinamicamente -->
      </section>
    </main>
  </div>

  <script>
    // FunÃ§Ã£o para atualizar as informaÃ§Ãµes do utilizador
    function atualizarUtilizador() {
      const nome = localStorage.getItem("userName") || "Utilizador nÃ£o logado";
      const email = localStorage.getItem("userEmail") || "Sem e-mail";
      
      // Preenche as informaÃ§Ãµes do utilizador
      document.getElementById("user-name").innerText = nome;
      document.getElementById("user-email").innerText = email;
    }

    // FunÃ§Ã£o para carregar as ocorrÃªncias armazenadas e exibir na pÃ¡gina
    function carregarOcorrencias() {
      const listaOcorrencias = document.getElementById("ocorrencias-lista");
      const ocorrencias = JSON.parse(localStorage.getItem("ocorrencias")) || [];
      
      ocorrencias.forEach(ocorrencia => {
        const ocorrenciaDiv = document.createElement("div");
        ocorrenciaDiv.classList.add("ocorrencia");

        ocorrenciaDiv.innerHTML = `
          <p class="ocorrencia-id">${ocorrencia.tipo}</p>
          <p class="ocorrencia-data">${ocorrencia.data}</p>
          <p class="ocorrencia-titulo">${ocorrencia.morada}</p>
          <p class="ocorrencia-local">${ocorrencia.cidade}</p>
          <span class="ocorrencia-status pendente">Pendente</span>
          <button class="detalhes-btn">Ver Detalhes</button>
          
        `;

          // Adiciona a lÃ³gica ao botÃ£o "Ver Detalhes"
          const detalhesBtn = ocorrenciaDiv.querySelector(".detalhes-btn");
          detalhesBtn.addEventListener("click", function() {
            // Salva o ID da ocorrÃªncia no localStorage
            localStorage.setItem("ocorrenciaID", ocorrencia.id);

          // Redireciona para a pÃ¡gina de detalhes
          window.location.href = "DetalheOcorrencia.html";
        });
        
        listaOcorrencias.appendChild(ocorrenciaDiv);
      });
    }

    // Chama a funÃ§Ã£o para atualizar as informaÃ§Ãµes do utilizador e carregar as ocorrÃªncias
    document.addEventListener("DOMContentLoaded", function() {
      atualizarUtilizador();
      carregarOcorrencias();
    });
  </script>
</body>
</html>
