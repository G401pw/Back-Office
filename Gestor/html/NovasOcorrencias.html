<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Novas Ocorrências - EyesEverywhere</title>
  <link rel="stylesheet" href="/Back-Office/Gestor/css/NovasOcorrencias.css" />
  <link rel="icon" href="/Back-Office/Gestor/Imagens/logo.png" type="image/x-icon" />
</head>
<body>
  <div class="sidebar">
    <div class="logo">
      <img src="/Back-Office/Gestor/Imagens/logo.png" alt="EyesEverywhere" />
    </div>
    <nav>
      <ul>
        <li><a data-page="Ocorrencias.html" href="Ocorrencias.html">📋 Ocorrências</a></li>
        <li><a class="active" data-page="NovasOcorrencias.html" href="NovasOcorrencias.html">➕ Novas Ocorrências</a></li>
        <li><a data-page="Peritos.html" href="Peritos.html">👥 Peritos</a></li>
        <li><a data-page="Registar_Peritos.html" href="Registar_Peritos.html">📝 Registar Peritos</a></li>
        <li><a data-page="Geral.html" href="Geral.html">🔍 Estatísticas</a></li>
      </ul>
    </nav>
    <div class="add-auditoria"> 
      <a href="/Back-Office/Gestor/html/PlanoAuditoria.html">
        <button>+ Adicionar Plano de Auditoria</button>
      </a>
    </div>
    <div class="user-info">
      <p id="user-name">Utilizador não logado</p>
      <p id="user-email">Sem e-mail</p>
    </div>
  </div>

  <div class="content">
    <header>
      <h1>Novas Ocorrências</h1>
    </header>

    <main>
      <section class="ocorrencias" id="ocorrencias-lista">
        <!-- As ocorrências serão carregadas aqui dinamicamente -->
      </section>
    </main>
  </div>

  <div id="feedback-message" class="feedback-message"></div>

  <script>
    // Função para atualizar as informações do utilizador
    function atualizarUtilizador() {
      const nome = localStorage.getItem("userName") || "Utilizador não logado";
      const email = localStorage.getItem("userEmail") || "Sem e-mail";
      
      // Preenche as informações do utilizador na sidebar
      document.getElementById("user-name").innerText = nome;
      document.getElementById("user-email").innerText = email;
    }

        // Função para carregar as ocorrências armazenadas e exibir na página
        // Função para carregar as ocorrências armazenadas e exibir na página
    function carregarOcorrencias() {
      const listaOcorrencias = document.getElementById("ocorrencias-lista");
      const ocorrencias = JSON.parse(localStorage.getItem("ocorrencias")) || [];

      ocorrencias.forEach(ocorrencia => {
        const ocorrenciaDiv = document.createElement("div");
        ocorrenciaDiv.classList.add("ocorrencia");

        // Definir a cor e o texto do estado
        let estadoClasse = "inicio";  // Padrão é "Início"
        let estadoTexto = "Início";  // Padrão é "Início"
        let estadoCor = "green";     // Padrão é verde

        // Se a ocorrência já foi enviada para mais informações, ela fica como "Pendente"
        if (ocorrencia.estado === "Pendente") {
          estadoClasse = "pendente";
          estadoTexto = "Pendente";
          estadoCor = "yellow";  // Amarelo
        }

        // Preencher com dados da ocorrência
        ocorrenciaDiv.innerHTML = `
          <p class="ocorrencia-id">${ocorrencia.tipo}</p>
          <p class="ocorrencia-data">${ocorrencia.data}</p>
          <p class="ocorrencia-titulo">${ocorrencia.morada}</p>
          <p class="ocorrencia-local">${ocorrencia.cidade}</p>
          <span class="ocorrencia-status ${estadoClasse}" style="background-color:${estadoCor};">${estadoTexto}</span>
          <button class="detalhes-btn">Ver Detalhes</button>
        `;

        // Adiciona a lógica ao botão "Ver Detalhes"
        const detalhesBtn = ocorrenciaDiv.querySelector(".detalhes-btn");
        detalhesBtn.addEventListener("click", function() {
          // Salva o ID da ocorrência no localStorage para ser usado na página de detalhes
          localStorage.setItem("ocorrenciaID", ocorrencia.id);

          // Redireciona para a página de detalhes
          window.location.href = "DetalheOcorrencia.html";
        });

        listaOcorrencias.appendChild(ocorrenciaDiv);
      });
    }


    // Chama a função para atualizar as informações do utilizador e carregar as ocorrências
    document.addEventListener("DOMContentLoaded", function() {
      atualizarUtilizador();
      carregarOcorrencias();
    });

    // Marcar a página de Novas Ocorrências como ativa na sidebar
    const menuItems = document.querySelectorAll("nav ul li a");
    menuItems.forEach(item => {
      if (item.getAttribute("href") === "NovasOcorrencias.html") {
        item.classList.add("active");
      }
    });
  </script>
</body>
</html>
